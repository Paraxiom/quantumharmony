# QSSL Reverse Proxy Configuration for QuantumHarmony
#
# This replaces nginx TLS with QSSL for quantum-safe RPC access.
#
# QSSL provides:
#   - SPHINCS+ KEM key exchange (patent-free, no Kyber)
#   - Falcon-512 signatures for authentication
#   - AES-256-GCM symmetric encryption
#
# Usage:
#   qssl-proxy --config /etc/qssl/proxy.conf
#
# Architecture:
#   Client <--QSSL--> Proxy <--plaintext--> Node RPC
#                      |
#                      v
#              Rate limiting, filtering

[server]
# Listen for QSSL connections
listen = "0.0.0.0:443"
# Certificate and key (Falcon-512)
certificate = "/etc/qssl/server.crt"
private_key = "/etc/qssl/server.key"

[crypto]
# Use patent-free SPHINCS+ KEM (not Kyber)
kem_algorithm = "sphincs+"
# Signature algorithm for authentication
signature_algorithm = "falcon-512"
# Symmetric cipher
cipher = "aes-256-gcm"
# Minimum security level (128, 192, or 256 bits)
min_security_level = 192

[backend]
# QuantumHarmony node RPC endpoints
[[backend.nodes]]
name = "validator1"
address = "172.28.0.10:9944"
weight = 1

[[backend.nodes]]
name = "validator2"
address = "172.28.0.11:9944"
weight = 1

[[backend.nodes]]
name = "validator3"
address = "172.28.0.12:9944"
weight = 1

# Load balancing strategy: round_robin, least_conn, random
strategy = "round_robin"

# Health check
health_check_interval = 30
health_check_path = "/health"

[rate_limiting]
# Requests per second per IP
rpc_rate = 10
ws_rate = 5
# Burst allowance
burst = 20
# Max connections per IP
max_connections = 50

[rpc_filtering]
# Block unsafe methods on public endpoint
blocked_methods = [
    "author_insertKey",
    "author_rotateKeys",
    "author_removeExtrinsic",
    "author_hasKey",
    "author_hasSessionKeys",
    "author_pendingExtrinsics",
    "system_addReservedPeer",
    "system_removeReservedPeer",
    "system_addLogFilter",
    "system_resetLogFilter",
]

# Allow these methods without rate limiting
unlimited_methods = [
    "chain_getBlockHash",
    "chain_getHeader",
    "system_health",
]

[websocket]
# Enable WebSocket upgrade for subscriptions
enabled = true
# Max message size (bytes) - larger for SPHINCS+ signatures
max_message_size = 1048576
# Ping interval
ping_interval = 30
# Idle timeout
idle_timeout = 3600

[logging]
level = "info"
format = "json"
file = "/var/log/qssl-proxy.log"

[metrics]
# Prometheus metrics endpoint (internal only)
enabled = true
listen = "127.0.0.1:9091"
